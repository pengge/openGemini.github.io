import{_ as l,X as c,Y as p,$ as d,a0 as s,a3 as n,C as u,Z as a,a1 as e}from"./framework-a5f096d1.js";const h={},k=n(`<h2 id="create-retention-policy" tabindex="-1"><a class="header-anchor" href="#create-retention-policy" aria-hidden="true">#</a> CREATE RETENTION POLICY</h2><h3 id="syntax" tabindex="-1"><a class="header-anchor" href="#syntax" aria-hidden="true">#</a> Syntax</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> RETENTION POLICY <span class="token operator">&lt;</span>retention_policy_name<span class="token operator">&gt;</span> <span class="token keyword">ON</span> <span class="token operator">&lt;</span>database_name<span class="token operator">&gt;</span> DURATION <span class="token operator">&lt;</span>duration<span class="token operator">&gt;</span> <span class="token keyword">REPLICATION</span> <span class="token operator">&lt;</span>n<span class="token operator">&gt;</span> <span class="token punctuation">[</span>SHARD DURATION <span class="token operator">&lt;</span>duration<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">INDEX</span> DURATION <span class="token operator">&lt;</span>duration<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="duration" tabindex="-1"><a class="header-anchor" href="#duration" aria-hidden="true">#</a> DURATION</h4><p><code>DURATION</code> determines how long openGemini keeps data. A retention policy has a minimum duration of one hour and a maximum duration of infinite.</p><h4 id="replication" tabindex="-1"><a class="header-anchor" href="#replication" aria-hidden="true">#</a> REPLICATION</h4><p><code>REPLICATION</code> determines how many independent replicas of each data point are stored in the cluster, currently only <code>1</code> replica is supported.</p><h4 id="shard-duration" tabindex="-1"><a class="header-anchor" href="#shard-duration" aria-hidden="true">#</a> SHARD DURATION</h4><ul><li>Optional, <code>SHARD DURATION</code> sets the time range of the shard group</li><li>By default, the data expiration time is determined by the <code>DURATION</code> of the retention policyï¼š</li></ul><table><thead><tr><th>DURATION</th><th>SHARD(GROUP) DURATION</th></tr></thead><tbody><tr><td>&lt; 2 days</td><td>1 hour</td></tr><tr><td>&gt;= 2 days and &lt;= 6 months</td><td>1 day</td></tr><tr><td>&gt; 6 months</td><td>7 days</td></tr></tbody></table><p><code>SHARD GROUP DURATION</code> minimum is<code>1h</code>.</p><p>If the <code>Create retention policy</code> query tries to set <code>SHARD GROUP DURATION</code> to be less than <code>1h</code> and greater than <code>0s</code>, openGemini will automatically set <code>SHARD GROUP DURATION</code> to <code>1h</code>.</p><p>If the <code>CREATE RETENTION POLICY</code> query tries to set <code>SHARD GROUP DURATION</code> to your <code>0s</code>, openGemini will automatically set <code>SHARD GROUP DURATION</code> according to the defaults listed above.</p><h4 id="index-duration" tabindex="-1"><a class="header-anchor" href="#index-duration" aria-hidden="true">#</a> INDEX DURATION</h4><ul><li>Optional, <code>INDEX DURATION</code> sets the time range of the index group</li></ul><h4 id="default" tabindex="-1"><a class="header-anchor" href="#default" aria-hidden="true">#</a> DEFAULT</h4><p>Set the new retention policy as the default retention policy for the database. This setting is optional.</p><h3 id="examples" tabindex="-1"><a class="header-anchor" href="#examples" aria-hidden="true">#</a> Examples</h3><ul><li><strong>Creating a retention policy</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> RETENTION POLICY <span class="token string">&quot;one_day_only&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span> DURATION <span class="token number">1</span>d <span class="token keyword">REPLICATION</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This query creates a retention policy named <code>one_day_only</code> for the database <code>NOAA_water_database</code> with a duration of <code>1d</code> and a replication factor of <code>1</code>.</p><ul><li><strong>Creating a default retention policy</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> RETENTION POLICY <span class="token string">&quot;one_day_only&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span> DURATION <span class="token number">24</span>h <span class="token keyword">REPLICATION</span> <span class="token number">1</span> <span class="token keyword">DEFAULT</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This query creates the same retention policy as the above example, but sets it as the default retention policy for the database.</p><ul><li><strong>Create a retention policy that does not expire</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> RETENTION POLICY <span class="token string">&quot;never_expire&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span> DURATION <span class="token number">0</span>s <span class="token keyword">REPLICATION</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This query creates a retention policy called <code>never_expire</code> for the database <code>NOAA_water_database</code>, the data under this policy will not expire.</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>A successful <code>CREATE RETENTION POLICY</code> query does not return any results.</p><p>If an attempt is made to create a retention policy with the same name as an existing policy, openGemini will not return an error.<br> If an attempt is made to create a retention policy with the same name as an existing retention policy, but with different attributes, openGemini will return an error.</p><p><strong>related entries</strong> <a href="./database">CREATE DATABASE</a></p></div><h2 id="show-retention-policies" tabindex="-1"><a class="header-anchor" href="#show-retention-policies" aria-hidden="true">#</a> SHOW RETENTION POLICIES</h2><p>Returns a list of <strong>reservation policies</strong> for the specified database.</p><h3 id="syntax-1" tabindex="-1"><a class="header-anchor" href="#syntax-1" aria-hidden="true">#</a> Syntax</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> RETENTION POLICIES <span class="token punctuation">[</span><span class="token keyword">ON</span> <span class="token operator">&lt;</span>database_name<span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>ON &lt;database_name&gt;</code> is optional. If the query does not contain <code>ON &lt;database_name&gt;</code>, you must specify the database in the CLI using <code>USE &lt;database_name&gt;</code> or in the openGemini API request using the parameter <code>db</code>.</p><h3 id="examples-1" tabindex="-1"><a class="header-anchor" href="#examples-1" aria-hidden="true">#</a> Examples</h3><h4 id="show-retention-policies-with-the-on-clause" tabindex="-1"><a class="header-anchor" href="#show-retention-policies-with-the-on-clause" aria-hidden="true">#</a> <code>SHOW RETENTION POLICIES</code> with the <code>ON</code> clause</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> RETENTION POLICIES <span class="token keyword">ON</span> NOAA_water_database
<span class="token operator">+</span><span class="token comment">---------+----------+--------------------+--------------+---------------+----------------+----------+---------+</span>
<span class="token operator">|</span> name    <span class="token operator">|</span> duration <span class="token operator">|</span> shardGroupDuration <span class="token operator">|</span> hot duration <span class="token operator">|</span> warm duration <span class="token operator">|</span> <span class="token keyword">index</span> duration <span class="token operator">|</span> replicaN <span class="token operator">|</span> <span class="token keyword">default</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----------+--------------------+--------------+---------------+----------------+----------+---------+</span>
<span class="token operator">|</span> autogen <span class="token operator">|</span> <span class="token number">0</span>s       <span class="token operator">|</span> <span class="token number">168</span>h0m0s           <span class="token operator">|</span> <span class="token number">0</span>s           <span class="token operator">|</span> <span class="token number">0</span>s            <span class="token operator">|</span> <span class="token number">168</span>h0m0s       <span class="token operator">|</span> <span class="token number">1</span>        <span class="token operator">|</span> <span class="token boolean">true</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----------+--------------------+--------------+---------------+----------------+----------+---------+</span>
<span class="token number">8</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This query returns all the retention policies in the database <code>NOAA_water_database</code> in tabular form. This database has a retention policy named <code>autogen</code> that has unlimited duration, a shard group duration of 7 days, a replication factor of 1, and it is the default (<code>DEFAULT</code>) retention policy for this database.</p><h4 id="show-retention-policies-without-the-on-clause" tabindex="-1"><a class="header-anchor" href="#show-retention-policies-without-the-on-clause" aria-hidden="true">#</a> <code>SHOW RETENTION POLICIES</code> without the <code>ON</code> clause</h4>`,38),m=a("p",null,[e("Specify the database using "),a("code",null,"USE <database_name>")],-1),b=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token operator"},">"),e(` use NOAA_water_database
`),a("span",{class:"token operator"},">"),e(` SHOW RETENTION POLICIES
+---------+----------+--------------------+--------------+---------------+----------------+----------+---------+
`),a("span",{class:"token operator"},"|"),e(" name    "),a("span",{class:"token operator"},"|"),e(" duration "),a("span",{class:"token operator"},"|"),e(" shardGroupDuration "),a("span",{class:"token operator"},"|"),e(" hot duration "),a("span",{class:"token operator"},"|"),e(" warm duration "),a("span",{class:"token operator"},"|"),e(" index duration "),a("span",{class:"token operator"},"|"),e(" replicaN "),a("span",{class:"token operator"},"|"),e(" default "),a("span",{class:"token operator"},"|"),e(`
+---------+----------+--------------------+--------------+---------------+----------------+----------+---------+
`),a("span",{class:"token operator"},"|"),e(" autogen "),a("span",{class:"token operator"},"|"),e(" 0s       "),a("span",{class:"token operator"},"|"),e(" 168h0m0s           "),a("span",{class:"token operator"},"|"),e(" 0s           "),a("span",{class:"token operator"},"|"),e(" 0s            "),a("span",{class:"token operator"},"|"),e(" 168h0m0s       "),a("span",{class:"token operator"},"|"),e(),a("span",{class:"token number"},"1"),e("        "),a("span",{class:"token operator"},"|"),e(),a("span",{class:"token boolean"},"true"),e("    "),a("span",{class:"token operator"},"|"),e(`
+---------+----------+--------------------+--------------+---------------+----------------+----------+---------+
`),a("span",{class:"token number"},"8"),e(" columns, "),a("span",{class:"token number"},"1"),e(" rows "),a("span",{class:"token keyword"},"in"),e(),a("span",{class:"token builtin class-name"},"set"),e(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"})])],-1),v=a("p",null,[e("Use the parameter "),a("code",null,"db"),e(" to specify the database")],-1),g=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token operator"},">"),e(),a("span",{class:"token function"},"curl"),e(),a("span",{class:"token parameter variable"},"-G"),e(),a("span",{class:"token string"},'"http://localhost:8086/query?db=NOAA_water_database&pretty=true"'),e(" --data-urlencode "),a("span",{class:"token string"},'"q=SHOW RETENTION POLICIES"'),e(`

`),a("span",{class:"token punctuation"},"{"),e(`
    `),a("span",{class:"token string"},'"results"'),a("span",{class:"token builtin class-name"},":"),e(),a("span",{class:"token punctuation"},"["),e(`
        `),a("span",{class:"token punctuation"},"{"),e(`
            `),a("span",{class:"token string"},'"statement_id"'),a("span",{class:"token builtin class-name"},":"),e(),a("span",{class:"token number"},"0"),e(`,
            `),a("span",{class:"token string"},'"series"'),a("span",{class:"token builtin class-name"},":"),e(),a("span",{class:"token punctuation"},"["),e(`
                `),a("span",{class:"token punctuation"},"{"),e(`
                    `),a("span",{class:"token string"},'"columns"'),a("span",{class:"token builtin class-name"},":"),e(),a("span",{class:"token punctuation"},"["),e(`
                        `),a("span",{class:"token string"},'"name"'),e(`,
                        `),a("span",{class:"token string"},'"duration"'),e(`,
                        `),a("span",{class:"token string"},'"shardGroupDuration"'),e(`,
                        `),a("span",{class:"token string"},'"hot duration"'),e(`,
                        `),a("span",{class:"token string"},'"warm duration"'),e(`,
                        `),a("span",{class:"token string"},'"index duration"'),e(`,
                        `),a("span",{class:"token string"},'"replicaN"'),e(`,
                        `),a("span",{class:"token string"},'"default"'),e(`
                    `),a("span",{class:"token punctuation"},"]"),e(`,
                    `),a("span",{class:"token string"},'"values"'),a("span",{class:"token builtin class-name"},":"),e(),a("span",{class:"token punctuation"},"["),e(`
                        `),a("span",{class:"token punctuation"},"["),e(`
                            `),a("span",{class:"token string"},'"autogen"'),e(`,
                            `),a("span",{class:"token string"},'"0s"'),e(`,
                            `),a("span",{class:"token string"},'"168h0m0s"'),e(`,
                            `),a("span",{class:"token string"},'"0s"'),e(`,
                            `),a("span",{class:"token string"},'"0s"'),e(`,
                            `),a("span",{class:"token string"},'"168h0m0s"'),e(`,
                            `),a("span",{class:"token number"},"1"),e(`,
                            `),a("span",{class:"token boolean"},"true"),e(`
                        `),a("span",{class:"token punctuation"},"]"),e(`
                    `),a("span",{class:"token punctuation"},"]"),e(`
                `),a("span",{class:"token punctuation"},"}"),e(`
            `),a("span",{class:"token punctuation"},"]"),e(`
        `),a("span",{class:"token punctuation"},"}"),e(`
    `),a("span",{class:"token punctuation"},"]"),e(`
`),a("span",{class:"token punctuation"},"}"),e(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"})])],-1),O=n(`<h2 id="alter-retention-policy" tabindex="-1"><a class="header-anchor" href="#alter-retention-policy" aria-hidden="true">#</a> ALTER RETENTION POLICY</h2><h3 id="syntax-2" tabindex="-1"><a class="header-anchor" href="#syntax-2" aria-hidden="true">#</a> Syntax</h3><p>The <code>ALTER RETENTION POLICY</code> query syntax is as follows and must declare at least one reservation policy attribute <code>DURATION</code>, <code>REPLICATION</code>, <code>SHARD DURATION</code> or <code>DEFAULT</code>:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> RETENTION POLICY <span class="token operator">&lt;</span>retention_policy_name<span class="token operator">&gt;</span> <span class="token keyword">ON</span> <span class="token operator">&lt;</span>database_name<span class="token operator">&gt;</span> DURATION <span class="token operator">&lt;</span>duration<span class="token operator">&gt;</span> <span class="token keyword">REPLICATION</span> <span class="token operator">&lt;</span>n<span class="token operator">&gt;</span> SHARD DURATION <span class="token operator">&lt;</span>duration<span class="token operator">&gt;</span> <span class="token keyword">DEFAULT</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">warning</p><p><code>REPLICATION &lt;n&gt;</code> only support 1</p></div><h3 id="examples-2" tabindex="-1"><a class="header-anchor" href="#examples-2" aria-hidden="true">#</a> Examples</h3><p>First, create the retention policy <code>what_is_time</code> with the 2d <code>DURATION</code>:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> RETENTION POLICY <span class="token string">&quot;what_is_time&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span> DURATION <span class="token number">2</span>d <span class="token keyword">REPLICATION</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Modify <code>what_is_time</code> to have three weeks of <code>DURATION</code>, two hours of slice group duration, and make it a <code>DEFAULT</code> retention policy for <code>NOAA_water_database</code>.</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> RETENTION POLICY <span class="token string">&quot;what_is_time&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span> DURATION <span class="token number">3</span>w SHARD DURATION <span class="token number">2</span>h <span class="token keyword">DEFAULT</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>In the last example, <code> what_is_time</code> retains its original replication factor <code>1</code>.</p><p>There does not return any results when <code>ALTER RETENTION POLICY</code> execute successful.</p><h2 id="drop-retention-policy" tabindex="-1"><a class="header-anchor" href="#drop-retention-policy" aria-hidden="true">#</a> DROP RETENTION POLICY</h2><div class="hint-container danger"><p class="hint-container-title">danger</p><p>Deleting a retention policy will permanently delete all measurements and data using that retention policy</p></div><h3 id="syntax-3" tabindex="-1"><a class="header-anchor" href="#syntax-3" aria-hidden="true">#</a> Syntax</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> RETENTION POLICY <span class="token operator">&lt;</span>retention_policy_name<span class="token operator">&gt;</span> <span class="token keyword">ON</span> <span class="token operator">&lt;</span>database_name<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="examples-3" tabindex="-1"><a class="header-anchor" href="#examples-3" aria-hidden="true">#</a> Examples</h3><p>Delete the retention policy <code>what_is_time</code> in the <code>NOAA_water_database</code> database:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> RETENTION POLICY <span class="token string">&quot;what_is_time&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>There does not return any results when <code>DROP RETENTION POLICY</code> execute successful.</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>If an attempt is made to delete a non-existent retention policy, openGemini will not return an error.</p></div>`,21);function y(N,T){const t=u("Tabs");return c(),p("div",null,[k,d(t,{id:"170",data:[{title:"ts-cli"},{title:"HTTP API"}]},{tab0:s(({title:o,value:r,isActive:i})=>[m,b]),tab1:s(({title:o,value:r,isActive:i})=>[v,g]),_:1}),O])}const A=l(h,[["render",y],["__file","retention_policy.html.vue"]]);export{A as default};
