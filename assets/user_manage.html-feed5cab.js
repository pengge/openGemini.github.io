import{_ as r,X as i,Y as c,Z as s,$ as n,a0 as e,a1 as a,a3 as t,C as l}from"./framework-a5f096d1.js";const d={},u=t(`<p>本部分内容主要介绍在openGemini内部如何创建用户、删除用户、授权等。<br> openemini无内置账号，开启鉴权，并成功启动后，需要主动创建系统唯一的管理员账号。openGemini的账号分为管理员账号和普通账号，对应角色分别是admin和user，管理员账号在系统内只能创建一次，不能删除，并且不能重命名。普通账号可以创建多个，由管理员创建，并且需要管理员授权才可以访问数据库。<br> 普通用户的权限和DB关联，权限分为READ、WRITE、ALL三种，分别表示可读、可写、可读写。如果一个普通用户被授予对DB的READ权限，则这个普通用户只能查询该DB的元数据以及DB内表中数据。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>先创建管理员账号，再开启https和身份认证</p></div><h2 id="初始状态创建管理员账号" tabindex="-1"><a class="header-anchor" href="#初始状态创建管理员账号" aria-hidden="true">#</a> 初始状态创建管理员账号</h2><p>启动openGemini单机或者集群</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> curl <span class="token operator">-</span>i <span class="token operator">-</span>XPOST <span class="token string">&quot;http://ip:8086/query&quot;</span> <span class="token operator">-</span>k <span class="token comment">--insecure --data-urlencode &quot;q=CREATE USER admin WITH PASSWORD &#39;admin-passwd&#39; WITH ALL PRIVILEGES&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>| 该命令创建了一个管理员账号，账号名称admin</p>`,6),k={class:"hint-container tip"},v=s("p",{class:"hint-container-title"},"提示",-1),m=s("li",null,"执行时，需要将命令中的IP地址和端口替换为实际环境中的ts-sql的ip和port，同时设置管理员账号名和密码",-1),b=s("li",null,"密码必须由大小写字母、数字、特殊字符组成，长度限制为8-256位字符",-1),g=s("li",null,"config/weakpasswd.properties为若密码配置文件，默认支持若密码校验，如果设置的密码与配置文件中的密码一致，则视为若密码，不允许使用。",-1),h=s("li",null,"密码字符串必须用单引号引起来，验证请求时，请包含单引号。",-1),q=t(`<p>也可以通过ts-cli连接openGemini, 通过客户端创建</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> ts-cli <span class="token parameter variable">-host</span> xxx <span class="token parameter variable">-port</span> xxx
openGemini CLI <span class="token number">0.1</span>.0 <span class="token punctuation">(</span>rev-revision<span class="token punctuation">)</span>
Please use <span class="token variable"><span class="token variable">\`</span>quit<span class="token variable">\`</span></span>, <span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">exit</span><span class="token variable">\`</span></span> or <span class="token variable"><span class="token variable">\`</span>Ctrl-D<span class="token variable">\`</span></span> to <span class="token builtin class-name">exit</span> this program.
<span class="token operator">&gt;</span> CREATE <span class="token environment constant">USER</span> admin WITH PASSWORD <span class="token string">&#39;nJa@w7f@12&#39;</span> WITH ALL PRIVILEGES
<span class="token operator">&gt;</span> SHOW USERS
+-------+-------+
<span class="token operator">|</span> user  <span class="token operator">|</span> admin <span class="token operator">|</span> 
+-------+-------+
<span class="token operator">|</span> admin <span class="token operator">|</span> <span class="token boolean">true</span>  <span class="token operator">|</span>
+-------+-------+
<span class="token number">2</span> columns, <span class="token number">1</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container danger"><p class="hint-container-title">警告</p><p>出于安全考虑，openGemini的管理员账号在系统内只能创建一次，不能删除，并且不能重命名。创建管理员账户前，请认真考虑用户名和密码<code>&lt;username&gt;</code>，并做好账号和密码的保存。</p></div><h2 id="开启身份认证和https功能" tabindex="-1"><a class="header-anchor" href="#开启身份认证和https功能" aria-hidden="true">#</a> 开启身份认证和https功能</h2>`,4),w=t(`<ol><li>如使用openGemini集群，修改配置文件openGemini.conf</li></ol><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">http</span><span class="token punctuation">]</span>
 <span class="token key property">auth-enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
 <span class="token key property">https-enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
 <span class="token key property">https-certificate</span> <span class="token punctuation">=</span> <span class="token string">&quot;path/to/certificate.crt&quot;</span>
 <span class="token key property">https-private-key</span> <span class="token punctuation">=</span> <span class="token string">&quot;path/to/certificate.key&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),y={start:"2"},_=s("strong",null,"添加",-1),R=t(`<div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">http</span><span class="token punctuation">]</span>
 <span class="token key property">auth-enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
 <span class="token key property">https-enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
 <span class="token key property">https-certificate</span> <span class="token punctuation">=</span> <span class="token string">&quot;path/to/certificate.crt&quot;</span>
 <span class="token key property">https-private-key</span> <span class="token punctuation">=</span> <span class="token string">&quot;path/to/certificate.key&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),x=t(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~$ ts-cli <span class="token parameter variable">-host</span> xx <span class="token parameter variable">-port</span> xx <span class="token parameter variable">-ssl</span> <span class="token parameter variable">-unsafeSsl</span>
openGemini CLI <span class="token number">0.1</span>.0 <span class="token punctuation">(</span>rev-revision<span class="token punctuation">)</span>
Please use <span class="token variable"><span class="token variable">\`</span>quit<span class="token variable">\`</span></span>, <span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">exit</span><span class="token variable">\`</span></span> or <span class="token variable"><span class="token variable">\`</span>Ctrl-D<span class="token variable">\`</span></span> to <span class="token builtin class-name">exit</span> this program.
<span class="token operator">&gt;</span> show databases
ERR: unable to parse authentication credentials
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述错误信息表示https和身份认证已经生效</p><h2 id="账号登陆" tabindex="-1"><a class="header-anchor" href="#账号登陆" aria-hidden="true">#</a> 账号登陆</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">~</span>$ ts<span class="token operator">-</span>cli <span class="token operator">-</span>host xx <span class="token operator">-</span>port xx <span class="token operator">-</span>ssl <span class="token operator">-</span>unsafeSsl
openGemini CLI <span class="token number">0.1</span><span class="token number">.0</span> <span class="token punctuation">(</span>rev<span class="token operator">-</span>revision<span class="token punctuation">)</span>
Please <span class="token keyword">use</span> <span class="token identifier"><span class="token punctuation">\`</span>quit<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>exit<span class="token punctuation">\`</span></span> <span class="token operator">or</span> <span class="token identifier"><span class="token punctuation">\`</span>Ctrl-D<span class="token punctuation">\`</span></span> <span class="token keyword">to</span> <span class="token keyword">exit</span> this program<span class="token punctuation">.</span>
<span class="token operator">&gt;</span> auth
username: admin  
password: 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>验证是否生效</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> show databases
name: databases
+------+
<span class="token operator">|</span> name <span class="token operator">|</span>
+------+

<span class="token number">1</span> columns, <span class="token number">0</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述命令正确执行，表示用户已生效，接下来就可以使用管理员用户创建普通用户或执行其他操作。</p><h2 id="创建普通用户" tabindex="-1"><a class="header-anchor" href="#创建普通用户" aria-hidden="true">#</a> 创建普通用户</h2><p>需要使用管理员登陆，才可以创建普通用户</p><p><strong>创建普通用户user0，不带任何权限，需要单独授权</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">USER</span> user0 <span class="token keyword">WITH</span> PASSWORD <span class="token string">&#39;your_pwd&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="show-users" tabindex="-1"><a class="header-anchor" href="#show-users" aria-hidden="true">#</a> SHOW USERS</h2><p>查看所有现有用户及其管理员状态</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> USERS
<span class="token operator">+</span><span class="token comment">-------+-------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>  <span class="token operator">|</span> admin <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------+</span>
<span class="token operator">|</span> admin <span class="token operator">|</span> <span class="token boolean">true</span>  <span class="token operator">|</span>
<span class="token operator">|</span> user0 <span class="token operator">|</span> <span class="token boolean">false</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+-------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="drop-user" tabindex="-1"><a class="header-anchor" href="#drop-user" aria-hidden="true">#</a> DROP USER</h2><p>删除用户</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token string">&quot;user0&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="grant" tabindex="-1"><a class="header-anchor" href="#grant" aria-hidden="true">#</a> GRANT</h2><p>授予现有用户对DB的 <code>READ</code>, <code>WRITE</code> or <code>ALL</code> 权限</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token punctuation">[</span><span class="token keyword">READ</span><span class="token punctuation">,</span><span class="token keyword">WRITE</span><span class="token punctuation">,</span><span class="token keyword">ALL</span><span class="token punctuation">]</span> <span class="token keyword">ON</span> <span class="token operator">&lt;</span>database_name<span class="token operator">&gt;</span> <span class="token keyword">TO</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p>授权<code>user0</code>对 <code>NOAA_water_database</code> 数据库读权限:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">READ</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span> <span class="token keyword">TO</span> <span class="token string">&quot;user0&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>授权<code>user0</code>对<code>NOAA_water_database</code> 数据库所有权限:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span> <span class="token keyword">TO</span> <span class="token string">&quot;user0&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="show-grants" tabindex="-1"><a class="header-anchor" href="#show-grants" aria-hidden="true">#</a> SHOW GRANTS</h2><p>查看指定用户现有权限</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> <span class="token string">&quot;user0&quot;</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------+</span>
<span class="token operator">|</span> <span class="token keyword">database</span>             <span class="token operator">|</span> privilege <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------+</span>
<span class="token operator">|</span> NOAA_water_database  <span class="token operator">|</span> <span class="token keyword">READ</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="revoke" tabindex="-1"><a class="header-anchor" href="#revoke" aria-hidden="true">#</a> REVOKE</h2><p>回收用户权限</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">REVOKE</span> <span class="token punctuation">[</span><span class="token keyword">READ</span><span class="token punctuation">,</span><span class="token keyword">WRITE</span><span class="token punctuation">,</span><span class="token keyword">ALL</span><span class="token punctuation">]</span> <span class="token keyword">ON</span> <span class="token operator">&lt;</span>database_name<span class="token operator">&gt;</span> <span class="token keyword">FROM</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p>取消 <code>user0</code>用户对 <code>NOAA_water_database</code> 数据库的写权限:</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">REVOKE</span> <span class="token keyword">WRITE</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;user0&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>取消 <code>user0</code>用户对 <code>NOAA_water_database</code> 所有权限：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">REVOKE</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token string">&quot;NOAA_water_database&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;user0&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="set-password" tabindex="-1"><a class="header-anchor" href="#set-password" aria-hidden="true">#</a> SET PASSWORD</h2><p>重置密码</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token string">&#39;&lt;password&gt;&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> <span class="token string">&quot;user0&quot;</span> <span class="token operator">=</span> <span class="token string">&#39;your_pwd&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>密码字符串必须用单引号引起来，验证请求时，请包含单引号</p><p>建议避免在密码中使用单引号（‘）和反斜杠（\\）字符，对于包含这些字符\\’的密码，在创建密码和提交身份验证请求时，请使用反斜杠对特殊字符进行转义，（例如（））</p></div>`,51);function A(O,E){const o=l("font"),p=l("RouterLink");return i(),c("div",null,[u,s("div",k,[v,s("ol",null,[m,b,g,h,s("li",null,[n(o,{color:"red"},{default:e(()=>[a("不建议")]),_:1}),a("在密码中使用单引号（‘）和反斜杠（\\）字符，对于包含这些字符\\’的密码，在创建密码和提交身份验证请求时，请使用反斜杠对特殊字符进行转义")])])]),q,s("p",null,[a("该部分内容可参考"),n(p,{to:"/zh/guide/security_user/authentication_and_authorization.html"},{default:e(()=>[a("身份认证和授权")]),_:1}),a("和"),n(p,{to:"/zh/guide/security_user/https.html"},{default:e(()=>[a("启用HTTPS")]),_:1})]),w,s("ol",y,[s("li",null,[a("如使用openGemini单机，修改配置文件openGemini.singlenode.conf,在[http]下"),n(o,{color:"red"},{default:e(()=>[_]),_:1}),a("如下内容")])]),R,s("p",null,[a("如果将crt文件和key文件合并为pem文件，则可以只配置https-certificate选项。"),n(p,{to:"/zh/guide/security_user/https.html"},{default:e(()=>[a("自验证证书制作参考-生成证书和密钥")]),_:1})]),s("p",null,[s("strong",null,[n(o,{color:"red"},{default:e(()=>[a("重启单机或者集群")]),_:1})]),a("，确保配置生效。")]),x])}const f=r(d,[["render",A],["__file","user_manage.html.vue"]]);export{f as default};
